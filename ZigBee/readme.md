# ONOKOM Zigbee Firmware

Каталог содержит **готовые прошивки Zigbee-устройств** ONOKOM.  
Прошивки разделены по моделям и версиям, с двумя каналами — стабильным и тестовым.

### Отличия между `main` и `unstable`
- **main** — проверенные и стабильные релизы с обратной совместимостью.
- **unstable** — предварительные сборки с новыми функциями и возможными багами.

## Формат имени файла прошивки
```
<model>_hw<rev>_fw<fwVersion>_ota<otaSpec>.ota
Пример: gr-1-zb-s_hw1x_fw0.5.0_ota15.ota
```
- `model` — модель устройства (например, `gr-1-zb-s`).
- `hw<rev>` — аппаратная ревизия указывается на наклейке устройства (например, `hw1x` = совместимо с HW 1.0/1.1/…).
- `fw<fwVersion>` — версия прошивки.
- `ota<otaSpec>` — версия формата Zigbee OTA (например, `15`).

---

# Инструкция по OTA-обновлению

Перед началом:
- Держите устройство **близко к координатору** (1–2 м), питание должно быть стабильным.
- Не отключайте питание до завершения обновления.

## Обновление через SprutHub

### SprutHub, SprutHub2 и SprutHub2 DIN
1. Извлеките MicroSD карту из устройства SprutHub, SprutHub2 и SprutHub2 DIN
2. Извлеченную MicroSD карту вставьте в компьтер или ноутбук
3. Откройте карту на вашем устройстве и передите в директории Spruthub/Firmware/ZigBee
4. Скачайте акутальную прошивку к себе на устройство
5. Скопируйте прошивку в длиректорию ZigBee по пути указанному в пункте 3
6. Установить MicroSD обратно в SprutHub, SprutHub2 или SprutHub2 DIN
7. Пергрузите SprutHub после перезагрузки начнется этап обновления устройства (занимает примерно 15 минут)
Оследить как обновляется устроство можно в интерфейсе SprutHub включив отладку

### SprutHub установленным на WirenBoard
1. Покдлчитесь к WirenBoard по SSH
2. Перейдите в директорию /mnt/data/makesimple/.Spruthub/data/Firmwares/ZigBee
3. Найдите актуальную версию и выполните команду 
   
    ```
    wget https://github.com/ONOKOM/firmware/raw/refs/heads/main/ZigBee/main/AUX-1-ZB-S/0.5.0/aux-1-zb-s_hw1.x_fw0.5.0_ota15.ota (ссылку замените на актуальную)
     ```
4. Пергрузите SprutHub после перезагрузки начнется этап обновления устройства (занимает примерно 15 минут)
Оследить как обновляется устроство можно в интерфейсе SprutHub включив отладку

### SprutHub установленным на Raspberry PI
1. Покдлчитесь к Raspberry PI по SSH
2. Перейдите в директорию /home/makesimple/.Spruthub/data/Firmwares/ZigBee
3. Найдите актуальную версию и выполните команду 
 ```
wget https://github.com/ONOKOM/firmware/raw/refs/heads/main/ZigBee/main/AUX-1-ZB-S/0.5.0/aux-1-zb-s_hw1.x_fw0.5.0_ota15.ota (ссылку замените на актуальную)
 ```
4. Пергрузите SprutHub после перезагрузки начнется этап обновления устройства (занимает примерно 15 минут)
Отследить как обновляется устроство можно в интерфейсе SprutHub включив отладку

## Обновление через Zigbee2MQTT

### Ручное обновление прошивки
1. Скопировать в папку zigbee2mqtt/data/ota новую прошивку в формате XXXX.ota, если папка ota отсутствует, необходимо создать её.
2. Добавить в файл конфигурации zigbee2mqtt zigbee2mqtt/data/configuration.yaml 
 ```
  ota:
    manual:
      url: ota/
    zigbee_ota_override_index_location: ota/my_index.json
```

3. Создать в папке zigbee2mqtt/data/ota файл my_index.json. Указать в нём имя файла новой прошивки, например:

 ```
 [
    {
		"version": 15,
		"url": "ota/app_zb_target_v0.5.0_ota15_HS3_enc.ota"
	}
]
```
4. Презагрузить Zigbee2MQTT


### Через веб-интерфейс
Обновить через веб-интерфейс zigbee2mqtt прошивку устройства:
1. Перейти во вкладку OTA из основной страницы;
2. Нажать Проверить все и таким образом проверить для каких устройств доступно обновление.
Если напротив устройства появилась кнопка Обновить прошивку устройства, то для данного устройства доступно обновление и нажав данную кнопку можно запустить обновление.
В процессе обновления будет отображаться примерное время и прогресс обновления. Обновление может занять и до получаса. Все зависит от качества связи устройства с координатором.


## Если возникли проблемы
- Сократите расстояние до координатора.
- Убедитесь, что файл прошивки соответствует вашей HW-ревизии и версии OTA.
